<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<meta charset="utf-8">
</head>
<body>
  <style>
    table { margin: auto; width:100%; color: white; border-collapse: separate; background: black; font-size: 120%}
    td.LeftPosition {text-align:center; vertical-align:middle; background:black; border: 5px solid red}
    td.RightPosition {text-align:center; vertical-align:middle; background:black; border: 5px solid blue}
    td.TimePosition {background-color:black; text-align:center; vertical-align:middle; color: green; border: 5px solid}
  </style>
  <table id="table" align="center">
    <tbody>
      <tr>
        <td class="LeftPosition" id="fam_left" style="width:40%"></td>
        <td class="LeftPosition" id="rate_left" style="width:5%"></td>
        <td class="TimePosition" id="time" colspan="2" rowspan="1" style="width:5%"></td>
        <td class="RightPosition" id="rate_right" style="width:5%"></td>
        <td class="RightPosition" id="fam_right"style="width:40%"></td>
      </tr>
      <tr>
        <td class="LeftPosition" id="next_left" colspan="3" rowspan="1" style="font-size: 80%; border-right: none; padding-right: 8%"></td>
        <td class="RightPosition" id="next_right" colspan="3" rowspan="1" style="font-size: 80%; border-left:none; padding-left: 8%"></td>
      </tr>
    </tbody>
  </table>
  <script>
    function processData(data){
      // Красный слева
      var fam_red = document.getElementById('fam_left');
      var rate_red = document.getElementById('rate_left');
      var fam_blue = document.getElementById('fam_right');
      var rate_blue = document.getElementById('rate_right');
      var next_red = document.getElementById('next_left');
      var next_blue = document.getElementById('next_right');
      if(data.PosRedInfo === 0){ // Красный справа
        fam_red = document.getElementById('fam_right');
        rate_red = document.getElementById('rate_right');
        fam_blue = document.getElementById('fam_left');
        rate_blue = document.getElementById('rate_left');
        next_red = document.getElementById('next_right');
        next_blue = document.getElementById('next_left');
      }
      var Table = document.getElementById('table');
      var TimeFight = document.getElementById('time')
      TimeFight.innerHTML = data.Time === undefined ? '' : data.Time;
      if(data.TimeEnabled){
        TimeFight.style.color = 'lightgreen';
        TimeFight.style.bordercolor = 'lightgreen';
      }else{
        TimeFight.style.color = 'green';
        TimeFight.style.bordercolor = 'green';
      }
      fam_red.style.borderColor = 'red';
      fam_red.innerHTML = data.FamilyRed === undefined ? '&nbsp;' : data.FamilyRed;
      rate_red.style.borderColor = 'red';
      rate_red.innerHTML = data.PlusRed === undefined ? '&nbsp;' : data.PlusRed + (data.RateRed === undefined ? '&nbsp;' : data.RateRed);
      fam_blue.style.borderColor = 'blue';
      fam_blue.innerHTML = data.FamilyBlue === undefined ? '&nbsp;' : data.FamilyBlue;
      rate_blue.style.borderColor = 'blue';
      rate_blue.innerHTML = data.PlusBlue === undefined ? '&nbsp;' : data.PlusBlue + (data.RateBlue === undefined ? '&nbsp;' : data.RateBlue); 
      next_red.style.borderColor = 'red';
      next_red.innerHTML = data.NextFamilyRed === undefined ? '&nbsp;' : data.NextFamilyRed;
      next_red.style.marginLeft = next_red.width - fam_red.width; 
      next_blue.style.borderColor = 'blue';
      next_blue.innerHTML = data.NextFamilyBlue === undefined ? '&nbsp;' : data.NextFamilyBlue;  data.NextFamilyBlue;
      if(data.hasOwnProperty("ShowNext")){
        document.ShowNext = data.ShowNext;
      }
      if(document.ShowNext){
        next_blue.style.display = ''; 
        next_red.style.display = ''; 
      }else{
        next_blue.style.display = 'none'; 
        next_red.style.display = 'none'; 
      }

      setTimeout(getData, 1000);
    }
    function getData() {
      fetch("/tablo")
        .then(response => {
          return response.json();
        })        
        .then(data => {
          processData(data);
        })
        .catch(error => {
          processData(JSON.stringify(''))
        });
    }
    document.ShowNext = true;  
    getData();
  </script>
</body>
</html>

